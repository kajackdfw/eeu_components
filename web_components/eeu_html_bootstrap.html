<!-- This set of components only requires base Polymer class and Bootstrap, no Polymer CSS Elements -->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap.min.css">
<link rel="stylesheet" href="../bower_components/bootstrap/dist/css/bootstrap-theme.min.css">
<!-- link rel="import" href="../bower_components/iron-input/iron-input.html" -->


<dom-module id="eeu-input-dec-fifrac" >

    <template>
        <p>
            Convert <strong>{{userstring}}</strong>
        </p>

        <br />

        <div class="input-group">

            <!-- Iron Element method for comparison only,
            <input is="iron-input"
                   name="{{field_name}}"
                   bind-value="{{userstring}}"
                   on-keyup="userstringChanged"
                   class="form-control"
                   aria-describedby="basic-addon2"
                   style="width: 7em;"
            > -->

            <!-- use the ::input extension to Bind this native html input field to our web component -->
            <input type="text" id="userstring" value="{{userstring::input}}" class="form-control" on-keyup="userstringChanged" aria-describedby="basic-addon2" style="width: 7em;" />
            <span class="input-group-addon" id="basic-addon2" style="width: 7em;">{{fifdimension}}</span>

        </div>

        <br />

        <button on-click="fifreset">Reset</button>

    </template>

    <script>

        function isNumeric(n) { return !isNaN(parseFloat(n)) && isFinite(n); }

        Polymer({

            is: "eeu-input-dec-fifrac",

            properties: {
                userstring: {
                    type: String
                },
                field_value: {
                    type: String,
                    value: "0"
                },
                field_name: {
                    type: String,
                    value: "undefined"
                }
            },

            ready: function() {
                this.userstring = this.field_value;
                this.userstringChanged();
                console.log('Ready');
            },

            fifreset: function() {
                this.userstring = '';
                this.fifdimension = '0"';
            },

            userstringChanged: function() {
                var someString = this.userstring ;
                var feet = 0;
                var inches = 0;
                var denominator = 64 ;
                var numerator = 0;

                if( isNumeric( someString ) )
                {
                    someString = Math.round( someString * 64 ) / 64 ;
                    feet = Math.floor( someString / 12 );
                    inch = Math.floor( someString - ( feet * 12 )) ;
                    numerator = Math.round(( someString - ( feet * 12 ) - inch ) * denominator );

                    for( denom = denominator; denom > 1 && ( numerator % 2 ) == 0 && numerator >= 1 ; denom--  )
                    {
                        numerator = numerator / 2 ;
                        denominator = denominator / 2 ;
                    }

                    if( feet > 0 )
                    {
                        this.fifdimension = feet + "'-" + inch ;
                    }
                    else
                    {
                        this.fifdimension = inch ;
                    }

                    if( numerator > 0 )
                    {
                        this.fifdimension = this.fifdimension + '-' + numerator + '/' + denominator + '"';
                    }
                    else
                    {
                        this.fifdimension = this.fifdimension + '"'
                    }
                }
                else
                {
                    this.fifdimension = 'Invalid';
                }
            }
        });

    </script>

</dom-module>


